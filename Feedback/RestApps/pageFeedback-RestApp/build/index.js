(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var n in t)e.o(t,n)&&!e.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:t[n]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=require("router");var t=e.n(a);const n=require("MailUtil");var r=e.n(n);const s=require("LogUtil");var o=e.n(s);const i=function(e){o().info(JSON.stringify(e.pageName));try{return r().getMailBuilder().setSubject("New feedback on ".concat(e.pageName)).setHtmlMessage("".concat(e.name," has provided this feedback: ").concat(e.feedback,',\n         Link to site: <a href="').concat(e.pageURL,'">').concat(e.pageName,"</a> ")).addRecipient(e.email).build().send(),!0}catch(e){return console.error("Cant send email:",e),!1}};t().get("/sendEmail",(function(e,a){var t={email:e.params.email,name:e.params.name,feedback:e.params.feedback,pageURL:e.params.pageURL,pageName:e.params.pageName};return i(t)?a.status(204).send("Email was successfully sent."):a.status(400).send("Failed to send Email.")}));const c=require("events");var d=e.n(c);const u=require("storage");var l=e.n(u)().getCollectionDataStore("feedback");d().on("sv:publishing:publish",(function(e){var a;a=e.node,l.find("ds.analyzed.page:".concat(a," ds.analyzed.isOutdated:false"),{count:100}).toArray().forEach((function(e){if(!e.isOutdated){e.isOutdated=!0;try{l.set(e.dsid,e)}catch(e){o().info("Could not write to DataStore")}}}))}))})();